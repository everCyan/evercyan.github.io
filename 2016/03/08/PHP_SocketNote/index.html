<!DOCTYPE html>
<html lang="h-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="在云端" />



<meta name="description" content="#关于 PHP Socket 及位字符串函数 pack &amp;amp; unpack 的示例


严宇川, 2015.08.02
关于 PHP Socket 及位字符串函数 pack &amp;amp; unpack 的示例.">
<meta property="og:type" content="article">
<meta property="og:title" content="关于 PHP Socket 及位字符串函数 pack & unpack 的示例">
<meta property="og:url" content="http://evercyan.xyz/2016/03/08/PHP_SocketNote/index.html">
<meta property="og:site_name" content="在云端">
<meta property="og:description" content="#关于 PHP Socket 及位字符串函数 pack &amp;amp; unpack 的示例


严宇川, 2015.08.02
关于 PHP Socket 及位字符串函数 pack &amp;amp; unpack 的示例.">
<meta property="og:image" content="http://evercyan.xyz/img/source/php_socket_pack_unpack/1.png">
<meta property="og:image" content="http://evercyan.xyz/img/source/php_socket_pack_unpack/2.png">
<meta property="og:image" content="http://evercyan.xyz/img/source/php_socket_pack_unpack/3.png">
<meta property="og:updated_time" content="2016-03-07T16:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于 PHP Socket 及位字符串函数 pack & unpack 的示例">
<meta name="twitter:description" content="#关于 PHP Socket 及位字符串函数 pack &amp;amp; unpack 的示例


严宇川, 2015.08.02
关于 PHP Socket 及位字符串函数 pack &amp;amp; unpack 的示例.">
<meta name="twitter:image" content="http://evercyan.xyz/img/source/php_socket_pack_unpack/1.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="在云端" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>关于 PHP Socket 及位字符串函数 pack &amp; unpack 的示例 | 在云端</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">在云端</a></h1>
        </hgroup>

        

        


        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:evercyan@qq.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/everCyan" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">在云端</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">在云端</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:evercyan@qq.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/everCyan" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-PHP_SocketNote" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/08/PHP_SocketNote/" class="article-date">
      <time datetime="2016-03-07T16:00:00.000Z" itemprop="datePublished">2016-03-08</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      关于 PHP Socket 及位字符串函数 pack &amp; unpack 的示例
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Socket/">Socket</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>#关于 PHP Socket 及位字符串函数 pack &amp; unpack 的示例</p>
<hr>
<blockquote>
<p>严宇川, 2015.08.02</p>
<p>关于 PHP Socket 及位字符串函数 pack &amp; unpack 的示例.<a id="more"></a></p>
</blockquote>
<hr>
<h2 id="pack-amp-unpack-的封装"><a href="#pack-amp-unpack-的封装" class="headerlink" title="pack &amp; unpack 的封装"></a>pack &amp; unpack 的封装</h2><blockquote>
<p>在用 socket 和服务器交互过程中, 需要使用 pack 来将其他进制的数据压包到位字符串中; 接收到服务器返回的数据, 同样需要使用 unpack 来解析数据. </p>
<p>pack 的封装主要针对 String 来做的处理, 需要先压包其长度, 再压包其数据</p>
<p>unpack 的封装主要针对两种常见的返回格式, 一为 N (int)32, 二为 a (string), 其余格式可自行作扩展开发. 主要解决的痛点在于解析 String 时需要先解析其前置位字符长度.</p>
</blockquote>
<hr>
<h4 id="socketCommon-php"><a href="#socketCommon-php" class="headerlink" title="socketCommon.php"></a>socketCommon.php</h4><pre><code>&lt;?php
/***
 * Ryan 2015.08.01
 * pack &amp; unpack 封装
***/
class socketCommon {
    public static function packStr($str) {
        $retStr = pack(&quot;N&quot;, strlen($str) + 2);
        if (strlen($str) &gt; 0) {
            $retStr .= pack(&quot;a&quot; . strlen($str), $str);
        }
        $retStr .= pack(&quot;CC&quot;, &apos;\0&apos;, &apos;\0&apos;);
        return $retStr;
    }
    public static function unPackStr($parse, $packStr) {
        try {
            $result = array();

            $parseLen = strlen($parse);

            //解析格式位置
            $parsePos = 0;
            //数据源位置
            $dataPos = 0;
            //解析数据
            $parseStr = &quot;&quot;;

            while ($parsePos &lt; $parseLen) {
                $type = substr($parse, $parsePos++, 1);
                switch ($type) {
                    case &quot;N&quot; :
                        $parseStr = &quot;N1&quot;;
                        $strLen = 4;
                        while($parsePos &lt; $parseLen) {
                            $letter = substr($parse, $parsePos, 1);
                            if ($letter == &quot;/&quot;) {
                                break;
                            }
                            $parsePos++;
                            $parseStr .= $letter;
                        }
                        $unPackRet = unpack($parseStr, substr($packStr, $dataPos));
                        $result = array_merge($result, $unPackRet);
                        $dataPos += $strLen;
                        break;
                    case &quot;a&quot; : 
                        //字符串类型, 先解析在此之前的字符串长度
                        $parseStr = &quot;N1&quot;;
                        $unPackRet = unpack($parseStr, substr($packStr, $dataPos));
                        $strLen = array_pop($unPackRet);
                        $dataPos += 4;

                        $parseStr = &quot;a&quot; . $strLen;
                        while($parsePos &lt; $parseLen) {
                            $letter = substr($parse, $parsePos, 1);
                            if ($letter == &quot;/&quot;) {
                                break;
                            }
                            $parsePos++;
                            $parseStr .= $letter;
                        }    
                        $unPackRet = unpack($parseStr, substr($packStr, $dataPos));
                        $result = array_merge($result, $unPackRet);
                        $dataPos += $strLen;
                        break;
                }
            }
            return $result;
        } catch (exception $e) {
            return false;
        }
    }
}
</code></pre><hr>
<h4 id="packDemo-php"><a href="#packDemo-php" class="headerlink" title="packDemo.php"></a>packDemo.php</h4><pre><code>&lt;?php 
require &quot;./socketCommon.php&quot;;

//数据压包
$transId = time();
$msgStr = &quot;What the fuck!&quot;;
$lastStr = &quot;The Last Str&quot;;
$packBody = &quot;&quot;;

$packBody .= pack(&quot;N1&quot;, $transId);
$packBody .= socketCommon::packStr(iconv(&quot;UTF-8&quot;, &quot;unicodelittle&quot;, $msgStr));
$packBody .= socketCommon::packStr(iconv(&quot;UTF-8&quot;, &quot;unicodelittle&quot;, $lastStr));
$packBody .= socketCommon::packStr(iconv(&quot;UTF-8&quot;, &quot;unicodelittle&quot;, &quot;hello&quot;));
$packBody .= socketCommon::packStr(iconv(&quot;UTF-8&quot;, &quot;unicodelittle&quot;, &quot;world&quot;));

echo &quot;packBody Length : &quot;  . strlen($packBody);
echo &apos;&lt;br /&gt;&lt;br /&gt;&apos;;

//数据解析
$result = socketCommon::unPackStr(&apos;NtransId/astr1/astr2/astr3/astr4&apos;, $packBody);

echo &apos;&lt;pre&gt;&apos;;
print_r($result);

/*
Array
(
    [transId] =&gt; 1438498919
    [str1] =&gt; What the fuck!
    [str2] =&gt; The Last Str
    [str3] =&gt; hello
    [str4] =&gt; world
)
*/
</code></pre><h2 id="简单的-Socket-交互"><a href="#简单的-Socket-交互" class="headerlink" title="简单的 Socket 交互"></a>简单的 Socket 交互</h2><hr>
<h4 id="socketServer-php"><a href="#socketServer-php" class="headerlink" title="socketServer.php"></a>socketServer.php</h4><pre><code>&lt;?php
/***
 * Ryan 2015.08.01
 * php socketServer.php
***/
set_time_limit(0);   
date_default_timezone_set(&quot;PRC&quot;); 
error_reporting(0);

require &quot;./socketCommon.php&quot;;

$socketIp = &quot;127.0.0.1&quot;;
$socketPort = &quot;1935&quot;;

$sock = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
socket_set_option($sock, SOL_SOCKET, SO_REUSEADDR, 1) or die(&quot;socket_set_option fail&quot;);
socket_bind($sock, $socketIp, $socketPort) or die(&quot;socket_bind fail&quot;);
socket_listen($sock, 4) or die(&quot;socket_listen fail&quot;);
/*
接收消息格式 
包头 : 
    (int)32 cmdId + (int)32 packLen
包体 : 
    (int)32 transId + (string) msgStr + (int)32 userNum + (string) userJsonStr

返回消息格式
包头 : 
    (int)32 cmdId + (int)32 packLen
包体 : 
    (int)32 transId + (int)32 result + (string) msgStr
*/
do {
    $msgSock = socket_accept($sock); 
    if ($msgSock) {
        $receiveBuf = socket_read($msgSock, 4096);

        //解消息体
        $receiveObj = socketCommon::unPackStr(&quot;NcmdId/NpackLen/NtransId/amsgStr/NuserNum/auserJsonStr&quot;, $receiveBuf);
        echo &quot;receiveMsg : &quot; . json_encode($receiveObj) . &quot;\n&quot;;


        //组返回消息体
        $packBody = pack(&quot;N1&quot;, $receiveObj[&quot;transId&quot;]);
        $result = 0;
        $packBody .= pack(&quot;N1&quot;, $result);
        $msgStr = &quot;It&apos;s success at &quot; . date(&quot;Y-m-d H:i:s&quot;) . &quot;!&quot;;
        $packBody .= socketCommon::packStr($msgStr);

        $cmdId = 1000;
        $packLen = 20 + strlen($packBody);
        $packHead = pack(&quot;N2&quot;, $cmdId, $packLen);

        $returnMsg = $packHead . $packBody;

        // $returnMsg = &quot;Hello&quot;;

        echo &quot;Socket Return Start\n&quot;;
        echo &quot;Socket returnMsg Length : &quot; . strlen($returnMsg) . &quot;\n&quot;;

        socket_write($msgSock, $returnMsg, strlen($returnMsg));
        socket_close($msgsock);
    }
} while (true);
socket_close($sock);
</code></pre><hr>
<h4 id="socketClient-php"><a href="#socketClient-php" class="headerlink" title="socketClient.php"></a>socketClient.php</h4><pre><code>&lt;?php
/***
 * Ryan 2015.08.01
 * php socketClient.php
***/
require &quot;./socketCommon.php&quot;;

error_reporting(0);
$socketIp = &quot;127.0.0.1&quot;;
$socketPort = &quot;1935&quot;;

$sock = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
$result = socket_connect($sock, $socketIp, $socketPort);


/*
接收消息格式 
包头 : 
    (int)32 cmdId + (int)32 packLen
包体 : 
    (int)32 transId + (string) msgStr + (int)32 userNum + (string) userJsonStr

返回消息格式
包头 : 
    (int)32 cmdId + (int)32 packLen
包体 : 
    (int)32 transId + (int)32 result + (string) msgStr
*/

$transId = time();
$msgStr = &quot;This is a message!&quot;;
$userObj = array(
    &quot;ryan&quot;, &quot;cyan&quot;
);

$packBody = pack(&quot;N1&quot;, $transId);
$packBody .= socketCommon::packStr($msgStr);
$packBody .= pack(&quot;N1&quot;, count($userObj));
$packBody .= socketCommon::packStr(json_encode($userObj));

$cmdId = 1000;
$packLen = 20 + strlen($packBody);
$packHead = pack(&quot;N2&quot;, $cmdId, $packLen);

$sendMsg = $packHead . $packBody;

// $sendMsg = &quot;Hello&quot;;

echo &quot;Socket Start\n&quot;;
echo &quot;Socket sendMsg Length : &quot; . strlen($sendMsg) . &quot;\n&quot;;

socket_write($sock, $sendMsg, strlen($sendMsg));

$i = 0;
do {
    $receiveMsg = socket_read($sock, 4096);
    $i++;
} while (!$receiveMsg &amp;&amp; $i &lt; 3);

//解消息体
$receiveObj = socketCommon::unPackStr(&quot;NcmdId/NpackLen/NtransId/Nresult/amsgStr&quot;, $receiveMsg);
echo &quot;receiveMsg : &quot; . json_encode($receiveObj) . &quot;\n&quot;;
socket_close($sock);
</code></pre><hr>
<h4 id="效果截图"><a href="#效果截图" class="headerlink" title="效果截图"></a>效果截图</h4><hr>
<p><img src="/img/source/php_socket_pack_unpack/1.png" alt=""></p>
<p><img src="/img/source/php_socket_pack_unpack/2.png" alt=""></p>
<hr>
<h2 id="Socket-聊天程序"><a href="#Socket-聊天程序" class="headerlink" title="Socket 聊天程序"></a>Socket 聊天程序</h2><pre><code>&lt;?php
/***
 * Ryan 2015.08.01
 * php socketChat.php
 * telnet 127.0.0.1 1935
***/
header(&quot;Content-type:text/html; charset=utf-8&quot;);
date_default_timezone_set(&quot;PRC&quot;);
set_time_limit(0);    

if(!extension_loaded(&quot;sockets&quot;)){    
    //提示开启PHP的SOCKET扩展
    die(&quot;please loaded php_sockets.dll&quot;);
}

$socketIp = &quot;127.0.0.1&quot;;
$socketPort = &quot;1935&quot;;

if(($sock = socket_create(AF_INET, SOCK_STREAM, SOL_TCP)) === false){    
    //创建SOCKET
    echo &quot;socket_create() failed; reason : &quot; . socket_strerror(socket_last_error($sock)) . &quot;\r\n&quot;;
    exit;
}
if (!socket_set_option($sock, SOL_SOCKET, SO_REUSEADDR, 1)) {
    //设置端口重用
    echo &apos;socket_set_option() failed; reason : &apos;. socket_strerror(socket_last_error($sock)) . &quot;\r\n&quot;;
    exit;
}
if(socket_bind($sock, $socketIp, $socketPort) === false){    
    //绑定地址和端口
    echo &quot;socket_bind() failed; reason : &quot; . socket_strerror(socket_last_error($sock)) . &quot;\r\n&quot;;
    exit;
}
if(socket_listen($sock, 15) === false){    
    //开启监听
    echo &quot;socket_listen() failed; reason : &quot; . socket_strerror(socket_last_error($sock)) . &quot;\r\n&quot;;
    exit;
}

//设置非阻塞模式
socket_set_nonblock($sock) or die(&quot;not set nonblock&quot;);


//设置输入字符串长度  
$msgLen = 1024;  
//信息结束标记.   
$msgEof = &quot;\n&quot;;  
$connections = array();
do{
    //等待来自客户端的连接请求
    @$connection = socket_accept($sock);    
    if(isset($connection) &amp;&amp; $connection) {
        echo &quot;Connect Success!\r\n&quot;;
        $connections[] = array(
            &quot;connect&quot; =&gt; $connection, 
            &quot;bufs&quot; =&gt; &quot;&quot;
        );
        //返回初始化欢迎信息
        $welcomeMsg = &quot;Hello, Welcome! There are &quot; . count($connections) . &quot; Client connect success!\r\n&quot;;
        $welcomeMsg .= &quot;Type &apos;quit&apos; to quit!\r\n&quot;;
        $welcomeMsg .= &quot;Please type something as your nickname!\r\n\r\n&quot;;        
        socket_write($connection, $welcomeMsg, strlen($welcomeMsg));    
    }
    $talkBufs = &quot;&quot;;
    foreach($connections as $xid =&gt; &amp;$client) {
        unset($bufs);
        unset($connection);
        $connection = $client[&quot;connect&quot;];
        $bufs = &amp;$client[&quot;bufs&quot;];

        if(false === socket_write($connection, $talkBack, strlen($talkBack))) {
            echo &quot;socket_write() failed: reason: &quot; . socket_strerror(socket_last_error($connection)) . &quot;\r\n&quot;;
            socket_close($connection);
            unset($connections[$xid]);
            continue;
        }
        if (false === ($buf = socket_read($connection, $msgLen))) {
            continue;
        }
        $bufs .= $buf;
        if(false === strpos($bufs, $msgEof)) {
            continue;
        }
        //取得$bufs中结束标记符前的内容
        $buf = substr($bufs, 0, strrpos($bufs, $msgEof));    
        $bufs = substr(strrchr($bufs, $msgEof), 1);
        if (!$buf = trim($buf)) {
            continue;
        }
        if(strrpos($buf, $msgEof) || (strlen($buf) &gt; $msgLen)) {
            $buf = &quot;quit&quot;;
        }
        //退出连接
        if ($buf == &quot;quit&quot;) {
            socket_close($connection);
            unset($connections[$xid]);
            continue;
        }
        //处理聊天成员的昵称显示
        if(!isset($userName[$xid])){
            $userName[$xid] = $buf;
            $talkBufs .= &quot;Someone named &quot; . $userName[$xid] . &quot; is in!\r\n\r\n&quot;;
        } else {
            $talkBufs .= $userName[$xid] . &quot; &quot; . date(&quot;H:i:s&quot;) . &quot; : \r\n$buf\r\n\r\n&quot;;
        }
    }
    //组包返回内容
    $talkBack = $talkBufs;
    echo $talkBack;
} while (true);
socket_close($sock);
</code></pre><h4 id="效果截图-1"><a href="#效果截图-1" class="headerlink" title="效果截图"></a>效果截图</h4><hr>
<p><img src="/img/source/php_socket_pack_unpack/3.png" alt=""></p>
<hr>
<p>以上</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/03/08/PHP_SocketNote/">关于 PHP Socket 及位字符串函数 pack &amp; unpack 的示例</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">在云端</a></p>
        <p><span>发布时间:</span>2016-03-08, 00:00:00</p>
        <p><span>最后更新:</span>2016-03-08, 00:00:00</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/03/08/PHP_SocketNote/" title="关于 PHP Socket 及位字符串函数 pack &amp; unpack 的示例">http://evercyan.xyz/2016/03/08/PHP_SocketNote/</a>
            <span class="copy-path" data-clipboard-text="原文: http://evercyan.xyz/2016/03/08/PHP_SocketNote/　　作者: 在云端" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2016/04/01/PHP_Extension/">
                    PHP 扩展开发笔记
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/03/01/Note_Less/">
                    LESS 笔记
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#pack-amp-unpack-的封装"><span class="toc-number">1.</span> <span class="toc-text">pack & unpack 的封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#socketCommon-php"><span class="toc-number">1.0.1.</span> <span class="toc-text">socketCommon.php</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#packDemo-php"><span class="toc-number">1.0.2.</span> <span class="toc-text">packDemo.php</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#简单的-Socket-交互"><span class="toc-number">2.</span> <span class="toc-text">简单的 Socket 交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#socketServer-php"><span class="toc-number">2.0.1.</span> <span class="toc-text">socketServer.php</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#socketClient-php"><span class="toc-number">2.0.2.</span> <span class="toc-text">socketClient.php</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#效果截图"><span class="toc-number">2.0.3.</span> <span class="toc-text">效果截图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Socket-聊天程序"><span class="toc-number">3.</span> <span class="toc-text">Socket 聊天程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#效果截图-1"><span class="toc-number">3.0.1.</span> <span class="toc-text">效果截图</span></a></li></ol></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>





    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2016/03/08/PHP_SocketNote/" data-title="关于 PHP Socket 及位字符串函数 pack &amp; unpack 的示例" data-url="http://evercyan.xyz/2016/03/08/PHP_SocketNote/"></div>
    <script>
        var duoshuoQuery = {short_name:"evercyan"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/04/01/PHP_Extension/" title="上一篇: PHP 扩展开发笔记">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/03/01/Note_Less/" title="下一篇: LESS 笔记">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/06/04/Note_Gitbook/">Gitbook 笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/01/Tech_WhatHappened/">当时发生了什么？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/01/PHP_ScrapyGta5/">GTA5 攻略</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/01/PHP_Extension/">PHP 扩展开发笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/08/PHP_SocketNote/">关于 PHP Socket 及位字符串函数 pack & unpack 的示例</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/01/Note_Less/">LESS 笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/01/Article_SomethingJustHappened/">躲不过的时间</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/14/Tech_HighConcurrency/">关于高并发的解决方案及其相关概念的初步认识</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/01/Article_Poetry/">涂鸦小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/01/Article_Like/">古文</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/01/Hello_World/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016 在云端
            </div>
            <div class="footer-right">
                由 <a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a> 强力驱动 <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
    </div>
</footer>

    </div>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>